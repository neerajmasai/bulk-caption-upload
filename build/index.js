(()=>{"use strict";const e=window.React,t=window.wp.hooks,a=window.wp.compose,n=window.wp.element,l=window.wp.blockEditor,i=window.wp.components,r=window.wp.i18n,o={af:"Afrikaans",ar:"Arabic",bg:"Bulgarian",bn:"Bengali",ca:"Catalan",cs:"Czech",cy:"Welsh",da:"Danish",de:"German",el:"Greek",en:"English",es:"Spanish",et:"Estonian",eu:"Basque",fa:"Persian",fi:"Finnish",fr:"French",ga:"Irish",gl:"Galician",gu:"Gujarati",he:"Hebrew",hi:"Hindi",hr:"Croatian",hu:"Hungarian",hy:"Armenian",id:"Indonesian",is:"Icelandic",it:"Italian",ja:"Japanese",ka:"Georgian",kn:"Kannada",ko:"Korean",lt:"Lithuanian",lv:"Latvian",mk:"Macedonian",ml:"Malayalam",mr:"Marathi",ms:"Malay",mt:"Maltese",nl:"Dutch",no:"Norwegian",pa:"Punjabi",pl:"Polish",pt:"Portuguese",ro:"Romanian",ru:"Russian",sk:"Slovak",sl:"Slovenian",sq:"Albanian",sr:"Serbian",sv:"Swedish",sw:"Swahili",ta:"Tamil",te:"Telugu",th:"Thai",tl:"Filipino",tr:"Turkish",uk:"Ukrainian",ur:"Urdu",vi:"Vietnamese",zh:"Chinese",zu:"Zulu",english:"English",spanish:"Spanish",french:"French",german:"German",italian:"Italian",portuguese:"Portuguese",russian:"Russian",japanese:"Japanese",korean:"Korean",chinese:"Chinese",arabic:"Arabic",hindi:"Hindi",dutch:"Dutch",polish:"Polish",turkish:"Turkish",swedish:"Swedish",danish:"Danish",norwegian:"Norwegian",finnish:"Finnish",greek:"Greek",czech:"Czech",romanian:"Romanian",hungarian:"Hungarian",ukrainian:"Ukrainian",thai:"Thai",vietnamese:"Vietnamese",indonesian:"Indonesian",malay:"Malay",hebrew:"Hebrew",persian:"Persian",bengali:"Bengali"},s={"zh-cn":{srcLang:"zh-CN",label:"Chinese (Simplified)"},"zh-tw":{srcLang:"zh-TW",label:"Chinese (Traditional)"},"zh-hk":{srcLang:"zh-HK",label:"Chinese (Traditional, HK)"},"zh-sg":{srcLang:"zh-SG",label:"Chinese (Simplified, SG)"}};function c({attributes:t,setAttributes:a,onClose:l}){const[c,p]=(0,n.useState)([]),[d,u]=(0,n.useState)(!1),[h,m]=(0,n.useState)(null);function g(e){const t=Array.from(e).filter(e=>e.name.toLowerCase().endsWith(".vtt")||"text/vtt"===e.type).map(e=>{const t=function(e){if(!e)return{srcLang:"",label:""};const t=e.replace(/\.vtt$/i,"").split(/[._\s]+/).filter(Boolean);for(let e=t.length-1;e>=0;e--){const a=t[e],n=a.toLowerCase();if(s[n])return s[n];const l=a.match(/^([a-zA-Z]{2,3})-([a-zA-Z]{2,4})$/);if(l){const e=l[1].toLowerCase(),t=l[2].toUpperCase(),a=o[e];if(a){const n=t===e.toUpperCase()?a:`${a} (${t})`;return{srcLang:`${e}-${t}`,label:n}}}const i=o[n];if(i)return{srcLang:n,label:i}}return{srcLang:"",label:""}}(e.name);return{file:e,srcLang:t.srcLang,label:t.label}});p(e=>[...e,...t])}function b(e,t,a){p(n=>n.map((n,l)=>l===e?{...n,[t]:a}:n))}return(0,e.createElement)(i.Modal,{title:(0,r.__)("Bulk Upload Captions","bulk-caption-upload"),onRequestClose:l,style:{maxWidth:"640px",width:"100%"}},(0,e.createElement)("div",{className:"bcu-dropzone",onDragOver:function(e){e.preventDefault()},onDrop:function(e){e.preventDefault(),g(e.dataTransfer.files)},style:{border:"2px dashed #ccc",borderRadius:"4px",padding:"24px",textAlign:"center",marginBottom:"16px",backgroundColor:"#f9f9f9",cursor:"pointer"}},(0,e.createElement)(i.FormFileUpload,{multiple:!0,accept:".vtt,text/vtt",onChange:function(e){g(e.target.files)},render:({openFileDialog:t})=>(0,e.createElement)(i.Button,{variant:"secondary",onClick:t},(0,r.__)("Drop .vtt files here, or click to browse","bulk-caption-upload"))}),(0,e.createElement)("p",{style:{margin:"8px 0 0",color:"#757575",fontSize:"12px"}},(0,r.__)("Accepts .vtt files only","bulk-caption-upload"))),c.length>0&&(0,e.createElement)("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:"16px"}},(0,e.createElement)("thead",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",{style:{textAlign:"left",padding:"6px 8px",borderBottom:"1px solid #ddd",fontSize:"12px"}},(0,r.__)("File","bulk-caption-upload")),(0,e.createElement)("th",{style:{textAlign:"left",padding:"6px 8px",borderBottom:"1px solid #ddd",fontSize:"12px"}},(0,r.__)("Language Code","bulk-caption-upload")),(0,e.createElement)("th",{style:{textAlign:"left",padding:"6px 8px",borderBottom:"1px solid #ddd",fontSize:"12px"}},(0,r.__)("Label","bulk-caption-upload")),(0,e.createElement)("th",{style:{width:"32px",borderBottom:"1px solid #ddd"}}))),(0,e.createElement)("tbody",null,c.map((t,a)=>(0,e.createElement)("tr",{key:a},(0,e.createElement)("td",{style:{padding:"4px 8px",fontSize:"13px",maxWidth:"180px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},t.file.name),(0,e.createElement)("td",{style:{padding:"4px 8px"}},(0,e.createElement)(i.TextControl,{value:t.srcLang,onChange:e=>b(a,"srcLang",e),placeholder:"en",hideLabelFromVision:!0,label:(0,r.__)("Language Code","bulk-caption-upload"),style:{margin:0}})),(0,e.createElement)("td",{style:{padding:"4px 8px"}},(0,e.createElement)(i.TextControl,{value:t.label,onChange:e=>b(a,"label",e),placeholder:"English",hideLabelFromVision:!0,label:(0,r.__)("Label","bulk-caption-upload"),style:{margin:0}})),(0,e.createElement)("td",{style:{padding:"4px 8px",textAlign:"center"}},(0,e.createElement)(i.Button,{isDestructive:!0,variant:"link",onClick:()=>{return e=a,void p(t=>t.filter((t,a)=>a!==e));var e},label:(0,r.__)("Remove","bulk-caption-upload")},"âœ•")))))),h&&(0,e.createElement)(i.Notice,{status:"error",isDismissible:!1,style:{marginBottom:"16px"}},h),(0,e.createElement)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"8px"}},(0,e.createElement)(i.Button,{variant:"secondary",onClick:l,disabled:d},(0,r.__)("Cancel","bulk-caption-upload")),(0,e.createElement)(i.Button,{variant:"primary",isBusy:d,disabled:!c.length||d,onClick:function(){u(!0),m(null);const e=wp.data.select("core/block-editor").getSettings().mediaUpload,n=t.tracks||[],i=new Array(c.length).fill(null);let o=0;c.forEach(({file:t,srcLang:s,label:p},d)=>{e({allowedTypes:["text/vtt"],filesList:[t],onFileChange:([e])=>{const t=e&&e.url;if(t&&!t.startsWith("blob:")&&(i[d]={src:t,srcLang:s,label:p},o++,o===c.length)){const e=i.filter(Boolean);a({tracks:[...n,...e]}),u(!1),l()}},onError:()=>{if(i[d]=null,o++,o===c.length){const e=i.filter(Boolean);e.length&&a({tracks:[...n,...e]}),m((0,r.__)("Some files failed to upload.","bulk-caption-upload")),u(!1)}}})})}},0===c.length?(0,r.__)("Upload & Apply","bulk-caption-upload"):`${(0,r.__)("Upload & Apply","bulk-caption-upload")} (${c.length} ${1!==c.length?(0,r.__)("files","bulk-caption-upload"):(0,r.__)("file","bulk-caption-upload")})`)))}const p=(0,e.createElement)("svg",{viewBox:"0 0 38 25",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,e.createElement)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.5014 20.2854H28.6316V0.764648H0.110825V20.2854H11.241L14.3712 24.2854L17.5014 20.2854ZM14.3712 21.0401L16.5269 18.2854H26.6316V2.76465H2.11082V18.2854H12.2155L14.3712 21.0401Z"}),(0,e.createElement)("path",{d:"M10.4503 14.9446C9.56226 14.9446 8.76226 14.7606 8.05026 14.3926C7.33826 14.0166 6.77826 13.4966 6.37026 12.8326C5.97026 12.1606 5.77026 11.4006 5.77026 10.5526C5.77026 9.70464 5.97026 8.94864 6.37026 8.28464C6.77826 7.61264 7.33826 7.09264 8.05026 6.72464C8.76226 6.34864 9.56226 6.16064 10.4503 6.16064C11.2663 6.16064 11.9943 6.30464 12.6343 6.59264C13.2743 6.88064 13.8023 7.29664 14.2183 7.84064L12.4303 9.43664C11.9103 8.78064 11.2983 8.45264 10.5943 8.45264C10.0023 8.45264 9.52626 8.64464 9.16626 9.02864C8.80626 9.40464 8.62626 9.91264 8.62626 10.5526C8.62626 11.1926 8.80626 11.7046 9.16626 12.0886C9.52626 12.4646 10.0023 12.6526 10.5943 12.6526C11.2983 12.6526 11.9103 12.3246 12.4303 11.6686L14.2183 13.2646C13.8023 13.8086 13.2743 14.2246 12.6343 14.5126C11.9943 14.8006 11.2663 14.9446 10.4503 14.9446Z"}),(0,e.createElement)("path",{d:"M19.2042 14.9446C18.3162 14.9446 17.5162 14.7606 16.8042 14.3926C16.0922 14.0166 15.5322 13.4966 15.1242 12.8326C14.7242 12.1606 14.5242 11.4006 14.5242 10.5526C14.5242 9.70464 14.7242 8.94864 15.1242 8.28464C15.5322 7.61264 16.0922 7.09264 16.8042 6.72464C17.5162 6.34864 18.3162 6.16064 19.2042 6.16064C20.0202 6.16064 20.7482 6.30464 21.3882 6.59264C22.0282 6.88064 22.5562 7.29664 22.9722 7.84064L21.1842 9.43664C20.6642 8.78064 20.0522 8.45264 19.3482 8.45264C18.7562 8.45264 18.2802 8.64464 17.9202 9.02864C17.5602 9.40464 17.3802 9.91264 17.3802 10.5526C17.3802 11.1926 17.5602 11.7046 17.9202 12.0886C18.2802 12.4646 18.7562 12.6526 19.3482 12.6526C20.0522 12.6526 20.6642 12.3246 21.1842 11.6686L22.9722 13.2646C22.5562 13.8086 22.0282 14.2246 21.3882 14.5126C20.7482 14.8006 20.0202 14.9446 19.2042 14.9446Z"}),(0,e.createElement)("rect",{x:"33.1",y:"1.5",width:"1.8",height:"8",rx:"0.7"}),(0,e.createElement)("rect",{x:"30",y:"4.6",width:"8",height:"1.8",rx:"0.7"})),d=(0,a.createHigherOrderComponent)(t=>function(a){const[o,s]=(0,n.useState)(!1);return a.name.startsWith("presto-player/")&&Array.isArray(a.attributes.tracks)?(0,e.createElement)(n.Fragment,null,(0,e.createElement)(t,{...a}),(0,e.createElement)(l.BlockControls,null,(0,e.createElement)(i.ToolbarGroup,null,(0,e.createElement)(i.ToolbarButton,{label:(0,r.__)("Bulk Upload Captions","bulk-caption-upload"),icon:p,onClick:()=>s(!0)}))),o&&(0,e.createElement)(c,{attributes:a.attributes,setAttributes:a.setAttributes,onClose:()=>s(!1)})):(0,e.createElement)(t,{...a})},"withBulkCaptionUpload");(0,t.addFilter)("editor.BlockEdit","bulk-caption-upload/with-bulk-upload",d)})();