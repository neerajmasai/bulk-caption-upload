(()=>{"use strict";const e=window.React,t=window.wp.hooks,a=window.wp.compose,n=window.wp.element,l=window.wp.blockEditor,i=window.wp.components,o=window.wp.i18n,r={af:"Afrikaans",ar:"Arabic",bg:"Bulgarian",bn:"Bengali",ca:"Catalan",cs:"Czech",cy:"Welsh",da:"Danish",de:"German",el:"Greek",en:"English",es:"Spanish",et:"Estonian",eu:"Basque",fa:"Persian",fi:"Finnish",fr:"French",ga:"Irish",gl:"Galician",gu:"Gujarati",he:"Hebrew",hi:"Hindi",hr:"Croatian",hu:"Hungarian",hy:"Armenian",id:"Indonesian",is:"Icelandic",it:"Italian",ja:"Japanese",ka:"Georgian",kn:"Kannada",ko:"Korean",lt:"Lithuanian",lv:"Latvian",mk:"Macedonian",ml:"Malayalam",mr:"Marathi",ms:"Malay",mt:"Maltese",nl:"Dutch",no:"Norwegian",pa:"Punjabi",pl:"Polish",pt:"Portuguese",ro:"Romanian",ru:"Russian",sk:"Slovak",sl:"Slovenian",sq:"Albanian",sr:"Serbian",sv:"Swedish",sw:"Swahili",ta:"Tamil",te:"Telugu",th:"Thai",tl:"Filipino",tr:"Turkish",uk:"Ukrainian",ur:"Urdu",vi:"Vietnamese",zh:"Chinese",zu:"Zulu",english:"English",spanish:"Spanish",french:"French",german:"German",italian:"Italian",portuguese:"Portuguese",russian:"Russian",japanese:"Japanese",korean:"Korean",chinese:"Chinese",arabic:"Arabic",hindi:"Hindi",dutch:"Dutch",polish:"Polish",turkish:"Turkish",swedish:"Swedish",danish:"Danish",norwegian:"Norwegian",finnish:"Finnish",greek:"Greek",czech:"Czech",romanian:"Romanian",hungarian:"Hungarian",ukrainian:"Ukrainian",thai:"Thai",vietnamese:"Vietnamese",indonesian:"Indonesian",malay:"Malay",hebrew:"Hebrew",persian:"Persian",bengali:"Bengali"},s={"zh-cn":{srcLang:"zh-CN",label:"Chinese (Simplified)"},"zh-tw":{srcLang:"zh-TW",label:"Chinese (Traditional)"},"zh-hk":{srcLang:"zh-HK",label:"Chinese (Traditional, HK)"},"zh-sg":{srcLang:"zh-SG",label:"Chinese (Simplified, SG)"}};function c({attributes:t,setAttributes:a,onClose:l}){const[c,p]=(0,n.useState)([]),[d,u]=(0,n.useState)(!1),[h,m]=(0,n.useState)(null);function g(e){const t=Array.from(e).filter(e=>e.name.toLowerCase().endsWith(".vtt")||"text/vtt"===e.type).map(e=>{const t=function(e){if(!e)return{srcLang:"",label:""};const t=e.replace(/\.vtt$/i,"").split(/[._\s]+/).filter(Boolean);for(let e=t.length-1;e>=0;e--){const a=t[e],n=a.toLowerCase();if(s[n])return s[n];const l=a.match(/^([a-zA-Z]{2,3})-([a-zA-Z]{2,4})$/);if(l){const e=l[1].toLowerCase(),t=l[2].toUpperCase(),a=r[e];if(a){const n=t===e.toUpperCase()?a:`${a} (${t})`;return{srcLang:`${e}-${t}`,label:n}}}const i=r[n];if(i)return{srcLang:n,label:i}}return{srcLang:"",label:""}}(e.name);return{file:e,srcLang:t.srcLang,label:t.label}});p(e=>[...e,...t])}function b(e,t,a){p(n=>n.map((n,l)=>l===e?{...n,[t]:a}:n))}return(0,e.createElement)(i.Modal,{title:(0,o.__)("Bulk Upload Captions","bulk-caption-upload"),onRequestClose:l,style:{maxWidth:"640px",width:"100%"}},(0,e.createElement)("div",{className:"bcu-dropzone",onDragOver:function(e){e.preventDefault()},onDrop:function(e){e.preventDefault(),g(e.dataTransfer.files)},style:{border:"2px dashed #ccc",borderRadius:"4px",padding:"24px",textAlign:"center",marginBottom:"16px",backgroundColor:"#f9f9f9",cursor:"pointer"}},(0,e.createElement)(i.FormFileUpload,{multiple:!0,accept:".vtt,text/vtt",onChange:function(e){g(e.target.files)},render:({openFileDialog:t})=>(0,e.createElement)(i.Button,{variant:"secondary",onClick:t},(0,o.__)("Drop .vtt files here, or click to browse","bulk-caption-upload"))}),(0,e.createElement)("p",{style:{margin:"8px 0 0",color:"#757575",fontSize:"12px"}},(0,o.__)("Accepts .vtt files only","bulk-caption-upload"))),c.length>0&&(0,e.createElement)("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:"16px"}},(0,e.createElement)("thead",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",{style:{textAlign:"left",padding:"6px 8px",borderBottom:"1px solid #ddd",fontSize:"12px"}},(0,o.__)("File","bulk-caption-upload")),(0,e.createElement)("th",{style:{textAlign:"left",padding:"6px 8px",borderBottom:"1px solid #ddd",fontSize:"12px"}},(0,o.__)("Language Code","bulk-caption-upload")),(0,e.createElement)("th",{style:{textAlign:"left",padding:"6px 8px",borderBottom:"1px solid #ddd",fontSize:"12px"}},(0,o.__)("Label","bulk-caption-upload")),(0,e.createElement)("th",{style:{width:"32px",borderBottom:"1px solid #ddd"}}))),(0,e.createElement)("tbody",null,c.map((t,a)=>(0,e.createElement)("tr",{key:a},(0,e.createElement)("td",{style:{padding:"4px 8px",fontSize:"13px",maxWidth:"180px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},t.file.name),(0,e.createElement)("td",{style:{padding:"4px 8px"}},(0,e.createElement)(i.TextControl,{value:t.srcLang,onChange:e=>b(a,"srcLang",e),placeholder:"en",hideLabelFromVision:!0,label:(0,o.__)("Language Code","bulk-caption-upload"),style:{margin:0}})),(0,e.createElement)("td",{style:{padding:"4px 8px"}},(0,e.createElement)(i.TextControl,{value:t.label,onChange:e=>b(a,"label",e),placeholder:"English",hideLabelFromVision:!0,label:(0,o.__)("Label","bulk-caption-upload"),style:{margin:0}})),(0,e.createElement)("td",{style:{padding:"4px 8px",textAlign:"center"}},(0,e.createElement)(i.Button,{isDestructive:!0,variant:"link",onClick:()=>{return e=a,void p(t=>t.filter((t,a)=>a!==e));var e},label:(0,o.__)("Remove","bulk-caption-upload")},"âœ•")))))),h&&(0,e.createElement)(i.Notice,{status:"error",isDismissible:!1,style:{marginBottom:"16px"}},h),(0,e.createElement)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"8px"}},(0,e.createElement)(i.Button,{variant:"secondary",onClick:l,disabled:d},(0,o.__)("Cancel","bulk-caption-upload")),(0,e.createElement)(i.Button,{variant:"primary",isBusy:d,disabled:!c.length||d,onClick:function(){u(!0),m(null);const e=wp.data.select("core/block-editor").getSettings().mediaUpload,n=t.tracks||[],i=new Array(c.length).fill(null);let r=0;c.forEach(({file:t,srcLang:s,label:p},d)=>{e({allowedTypes:["text/vtt"],filesList:[t],onFileChange:([e])=>{const t=e&&e.url;if(t&&!t.startsWith("blob:")&&(i[d]={src:t,srcLang:s,label:p},r++,r===c.length)){const e=i.filter(Boolean);a({tracks:[...n,...e]}),u(!1),l()}},onError:()=>{if(i[d]=null,r++,r===c.length){const e=i.filter(Boolean);e.length&&a({tracks:[...n,...e]}),m((0,o.__)("Some files failed to upload.","bulk-caption-upload")),u(!1)}}})})}},0===c.length?(0,o.__)("Upload & Apply","bulk-caption-upload"):`${(0,o.__)("Upload & Apply","bulk-caption-upload")} (${c.length} ${1!==c.length?(0,o.__)("files","bulk-caption-upload"):(0,o.__)("file","bulk-caption-upload")})`)))}const p=(0,a.createHigherOrderComponent)(t=>function(a){const[r,s]=(0,n.useState)(!1);return a.name.startsWith("presto-player/")&&Array.isArray(a.attributes.tracks)?(0,e.createElement)(n.Fragment,null,(0,e.createElement)(t,{...a}),(0,e.createElement)(l.BlockControls,null,(0,e.createElement)(i.ToolbarGroup,null,(0,e.createElement)(i.ToolbarButton,{label:(0,o.__)("Bulk Upload Captions","bulk-caption-upload"),icon:"media-code",onClick:()=>s(!0)}))),r&&(0,e.createElement)(c,{attributes:a.attributes,setAttributes:a.setAttributes,onClose:()=>s(!1)})):(0,e.createElement)(t,{...a})},"withBulkCaptionUpload");(0,t.addFilter)("editor.BlockEdit","bulk-caption-upload/with-bulk-upload",p)})();